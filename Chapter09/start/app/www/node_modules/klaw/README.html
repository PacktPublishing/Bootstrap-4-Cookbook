<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="icon" href="../../favicon.ico">
    <title>
        My default title
    </title>

    <!-- Bootstrap core CSS -->
    <link href="css/main.css" rel="stylesheet">

</head>

<body>

    <nav class="navbar navbar-toggleable-md navbar-dark bg-faded">
  <button class="navbar-toggler navbar-toggler-right" type="button" data-toggle="collapse" data-target="#navbarsExampleDefault" aria-controls="navbarsExampleDefault" aria-expanded="false" aria-label="Toggle navigation">
  <span class="navbar-toggler-icon"></span>
  </button>
  <a class="navbar-brand" href="index.html">Chapter 9</a>
  <div class="collapse navbar-collapse" id="navbarsExampleDefault">
    <ul class="navbar-nav mr-auto">
      <li class="nav-item active">
        <li class="nav-item dropdown">
          <a class="nav-link dropdown-toggle" href="http://example.com" id="dropdown01" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Recipes</a>
          <div class="dropdown-menu" aria-labelledby="dropdown01">
            <a class="dropdown-item" href="recipe09-01">1 - Customizing Bootstrap Builds by Cherry-picking Sass Partials</a>
            <a class="dropdown-item" href="recipe09-02">2 - Cleaning up unused CSS with UnCSS and Grunt</a>
            <a class="dropdown-item" href="recipe09-03">3 - Removing CSS comments with grunt-strip-css-comments</a>
          </div>
        </li>
      </li>
    </ul>
  </div>
</nav>

        <h1>Node.js - klaw</h1><p>A Node.js file system walker extracted from <a href="https://github.com/jprichardson/node-fs-extra">fs-extra</a>.</p>
<p><a href="https://www.npmjs.org/package/klaw"><img src="https://img.shields.io/npm/v/klaw.svg?style=flat-square" alt="npm Package"></a>
<a href="http://travis-ci.org/jprichardson/node-klaw"><img src="https://api.travis-ci.org/jprichardson/node-klaw.svg" alt="build status"></a>
<a href="https://ci.appveyor.com/project/jprichardson/node-klaw/branch/master"><img src="https://ci.appveyor.com/api/projects/status/github/jprichardson/node-klaw?branch=master&amp;svg=true" alt="windows build status"></a></p>
<!-- [![js-standard-style](https://cdn.rawgit.com/feross/standard/master/badge.svg)](https://github.com/feross/standard) -->
<p><a href="http://standardjs.com"><img src="https://cdn.rawgit.com/feross/standard/master/sticker.svg" alt="Standard" width="100"></a></p>
<h2>Install</h2><pre><code>npm i --save klaw
</code></pre><h2>Name</h2><p><code>klaw</code> is <code>walk</code> backwards :p</p>
<h2>Usage</h2><h3>klaw(directory, [options])</h3><p>Returns a <a href="https://nodejs.org/api/stream.html#stream_class_stream_readable">Readable stream</a> that iterates
through every file and directory starting with <code>dir</code> as the root. Every <code>read()</code> or <code>data</code> event
returns an object with two properties: <code>path</code> and <code>stats</code>. <code>path</code> is the full path of the file and
<code>stats</code> is an instance of <a href="https://nodejs.org/api/fs.html#fs_class_fs_stats">fs.Stats</a>.</p>
<ul>
<li><code>directory</code>: The directory to recursively walk. Type <code>string</code>.</li>
<li><code>options</code>: <a href="https://nodejs.org/api/stream.html#stream_new_stream_readable_options">Readable stream options</a> and
the following:<ul>
<li><code>queueMethod</code> (<code>string</code>, default: <code>&#39;shift&#39;</code>): Either <code>&#39;shift&#39;</code> or <code>&#39;pop&#39;</code>. On <code>readdir()</code> array, call either <code>shift()</code> or <code>pop()</code>.</li>
<li><code>pathSorter</code> (<code>function</code>, default: <code>undefined</code>): Sorting <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/sort">function for Arrays</a>.</li>
<li><code>fs</code> (<code>object</code>, default: <code>require(&#39;fs&#39;)</code>): Use this to hook into the <code>fs</code> methods or to use <a href="https://github.com/tschaub/mock-fs"><code>mock-fs</code></a></li>
<li><code>filter</code> (<code>function</code>, default: <code>undefined</code>): Filtering <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/filter">function for Arrays</a></li>
</ul>
</li>
</ul>
<p><strong>Streams 1 (push) example:</strong></p>
<pre><code class="language-js">var klaw = require(&#39;klaw&#39;)

var items = [] // files, directories, symlinks, etc
klaw(&#39;/some/dir&#39;)
  .on(&#39;data&#39;, function (item) {
    items.push(item.path)
  })
  .on(&#39;end&#39;, function () {
    console.dir(items) // =&gt; [ ... array of files]
  })
</code></pre>
<p><strong>Streams 2 &amp; 3 (pull) example:</strong></p>
<pre><code class="language-js">var klaw = require(&#39;klaw&#39;)

var items = [] // files, directories, symlinks, etc
klaw(&#39;/some/dir&#39;)
  .on(&#39;readable&#39;, function () {
    var item
    while ((item = this.read())) {
      items.push(item.path)
    }
  })
  .on(&#39;end&#39;, function () {
    console.dir(items) // =&gt; [ ... array of files]
  })
</code></pre>
<p>If you&#39;re not sure of the differences on Node.js streams 1, 2, 3 then I&#39;d
recommend this resource as a good starting point: <a href="https://strongloop.com/strongblog/whats-new-io-js-beta-streams3/">https://strongloop.com/strongblog/whats-new-io-js-beta-streams3/</a>.</p>
<h3>Error Handling</h3><p>Listen for the <code>error</code> event.</p>
<p>Example:</p>
<pre><code class="language-js">var klaw = require(&#39;klaw&#39;)
klaw(&#39;/some/dir&#39;)
  .on(&#39;readable&#39;, function () {
    var item
    while ((item = this.read())) {
      // do something with the file
    }
  })
  .on(&#39;error&#39;, function (err, item) {
    console.log(err.message)
    console.log(item.path) // the file the error occurred on
  })
  .on(&#39;end&#39;, function () {
    console.dir(items) // =&gt; [ ... array of files]
  })
</code></pre>
<h3>Aggregation / Filtering / Executing Actions (Through Streams)</h3><p>On many occasions you may want to filter files based upon size, extension, etc.
Or you may want to aggregate stats on certain file types. Or maybe you want to
perform an action on certain file types.</p>
<p>You should use the module <a href="https://www.npmjs.com/package/through2"><code>through2</code></a> to easily
accomplish this.</p>
<p>Install <code>through2</code>:</p>
<pre><code>npm i --save through2
</code></pre><p><strong>Example (skipping directories):</strong></p>
<pre><code class="language-js">var klaw = require(&#39;klaw&#39;)
var through2 = require(&#39;through2&#39;)

var excludeDirFilter = through2.obj(function (item, enc, next) {
  if (!item.stats.isDirectory()) this.push(item)
  next()
})

var items = [] // files, directories, symlinks, etc
klaw(&#39;/some/dir&#39;)
  .pipe(excludeDirFilter)
  .on(&#39;data&#39;, function (item) {
    items.push(item.path)
  })
  .on(&#39;end&#39;, function () {
    console.dir(items) // =&gt; [ ... array of files without directories]
  })
</code></pre>
<p><strong>Example (ignore hidden directories):</strong></p>
<pre><code class="language-js">var klaw = require(&#39;klaw&#39;)
var path = require(&#39;path&#39;)

var filterFunc = function(item){
  var basename = path.basename(item)
  return basename === &#39;.&#39; || basename[0] !== &#39;.&#39;
}

klaw(&#39;/some/dir&#39;, { filter : filterFunc  })
  .on(&#39;data&#39;, function(item){
    // only items of none hidden folders will reach here
  })
</code></pre>
<p><strong>Example (totaling size of PNG files):</strong></p>
<pre><code class="language-js">var klaw = require(&#39;klaw&#39;)
var path = require(&#39;path&#39;)
var through2 = require(&#39;through2&#39;)

var totalPngsInBytes = 0
var aggregatePngSize = through2.obj(function (item, enc, next) {
  if (path.extname(item.path) === &#39;.png&#39;) {
    totalPngsInBytes += item.stats.size
  }
  this.push(item)
  next()
})

klaw(&#39;/some/dir&#39;)
  .pipe(aggregatePngSize)
  .on(&#39;data&#39;, function (item) {
    items.push(item.path)
  })
  .on(&#39;end&#39;, function () {
    console.dir(totalPngsInBytes) // =&gt; total of all pngs (bytes)
  })
</code></pre>
<p><strong>Example (deleting all .tmp files):</strong></p>
<pre><code class="language-js">var fs = require(&#39;fs&#39;)
var klaw = require(&#39;klaw&#39;)
var through2 = require(&#39;through2&#39;)

var deleteAction = through2.obj(function (item, enc, next) {
  this.push(item)

  if (path.extname(item.path) === &#39;.tmp&#39;) {
    item.deleted = true
    fs.unklink(item.path, next)
  } else {
    item.deleted = false
    next()
  }  
})

var deletedFiles = []
klaw(&#39;/some/dir&#39;)
  .pipe(deleteAction)
  .on(&#39;data&#39;, function (item) {
    if (!item.deleted) return
    deletedFiles.push(item.path)
  })
  .on(&#39;end&#39;, function () {
    console.dir(deletedFiles) // =&gt; all deleted files
  })
</code></pre>
<p>You can even chain a bunch of these filters and aggregators together. By using
multiple pipes.</p>
<p><strong>Example (using multiple filters / aggregators):</strong></p>
<pre><code class="language-js">klaw(&#39;/some/dir&#39;)
  .pipe(filterCertainFiles)
  .pipe(deleteSomeOtherFiles)
  .on(&#39;end&#39;, function () {
    console.log(&#39;all done!&#39;)
  })
</code></pre>
<p><strong>Example passing (piping) through errors:</strong></p>
<p>Node.js does not <code>pipe()</code> errors. This means that the error on one stream, like
<code>klaw</code> will not pipe through to the next. If you want to do this, do the following:</p>
<pre><code class="language-js">var klaw = require(&#39;klaw&#39;)
var through2 = require(&#39;through2&#39;)

var excludeDirFilter = through2.obj(function (item, enc, next) {
  if (!item.stats.isDirectory()) this.push(item)
  next()
})

var items = [] // files, directories, symlinks, etc
klaw(&#39;/some/dir&#39;)
  .on(&#39;error&#39;, function (err) { excludeDirFilter.emit(&#39;error&#39;, err) }) // forward the error on
  .pipe(excludeDirFilter)
  .on(&#39;data&#39;, function (item) {
    items.push(item.path)
  })
  .on(&#39;end&#39;, function () {
    console.dir(items) // =&gt; [ ... array of files without directories]
  })
</code></pre>
<h3>Searching Strategy</h3><p>Pass in options for <code>queueMethod</code> and <code>pathSorter</code> to affect how the file system
is recursively iterated. See the code for more details, it&#39;s less than 50 lines :)</p>
<h2>License</h2><p>MIT</p>
<p>Copyright (c) 2015 <a href="https://github.com/jprichardson">JP Richardson</a></p>

	 <!-- Bootstrap core JavaScript
 ================================================== -->
 <!-- Placed at the end of the document so the pages load faster -->
     <script src="js/jquery.js"></script>
    <script src="js/tether.js"></script>
    <script src="js/bootstrap.js"></script>
    <script src="https://raw.githubusercontent.com/adobe-webplatform/css-shapes-polyfill/master/shapes-polyfill.min.js"></script>
    
	
		
	
	
		
	
	



</body>
</html>